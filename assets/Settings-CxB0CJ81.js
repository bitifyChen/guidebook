import{k as O,y as R,l as q,m as H,o as l,c as r,a as e,b as s,s as g,t as y,d as n,f as c,w as V,e as B,g as I,C as N,X,i as p,a0 as Z,h as G}from"./index-5qk_xDfl.js";import{U as T,P as J,L as h,a as K,u as Q}from"./storage-Bvfda-k-.js";import{b as $}from"./route-block-B_A1xBdJ.js";import{S as W,L as Y}from"./shield-check-DZZyY5Zm.js";/**
 * @license lucide-vue-next v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=O("TicketIcon",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]),te={class:"space-y-6 pb-20"},se={class:"bg-white p-8 rounded-[40px] border border-slate-100 flex flex-col items-center text-center relative group"},ae={class:"w-20 h-20 bg-slate-50 rounded-3xl flex items-center justify-center text-slate-300 mb-4 border border-slate-100 overflow-hidden"},le=["src"],ie={class:"text-xl font-black text-slate-800"},oe={class:"text-xs font-bold text-slate-400 uppercase tracking-widest mt-1"},re={key:0,class:"space-y-3"},ne={class:"bg-white p-6 rounded-[32px] border border-slate-100 space-y-4"},ce={class:"relative"},de={class:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-300"},ue=["disabled"],pe={class:"space-y-3"},fe={class:"bg-white rounded-[40px] border border-slate-100 overflow-hidden"},ve={class:"w-10 h-10 bg-indigo-50 rounded-xl flex items-center justify-center text-indigo-500 group-hover:scale-110 transition-transform"},xe={class:"w-10 h-10 bg-red-50 rounded-xl flex items-center justify-center text-red-400 group-hover:scale-110 transition-transform"},me={key:1,class:"fixed inset-0 z-[60] flex items-end sm:items-center justify-center p-4"},be={class:"relative w-full max-w-md bg-white rounded-[40px] shadow-2xl overflow-hidden animate-in slide-in-from-bottom duration-300"},ye={class:"p-8"},ge={class:"flex justify-between items-center mb-8"},he={class:"space-y-6"},ke={class:"flex flex-col items-center"},we={class:"w-24 h-24 rounded-3xl bg-slate-50 border-2 border-dashed border-slate-200 relative overflow-hidden group mb-2"},_e=["src"],Ce={key:1,class:"w-full h-full flex items-center justify-center text-slate-300"},Pe={key:2,class:"absolute inset-0 bg-white/80 flex items-center justify-center"},je={class:"flex gap-4"},ze={class:"space-y-2"},Se=["disabled"],Ue={__name:"Settings",setup(Le){const k=G(),a=R(),w=q(),f=p(""),x=p(!1),v=p(!1),m=p(!1),b=p(!1);H(v,d=>{d?document.body.style.overflow="hidden":document.body.style.overflow=""});const o=p({name:"",avatar:""}),E=()=>{a.myParticipant&&(o.value={name:a.myParticipant.name,avatar:a.myParticipant.avatar||""},v.value=!0)},_=p(null),C=()=>_.value.click(),F=async d=>{const t=d.target.files[0];if(t){m.value=!0;try{const i=await Q(t);o.value.avatar=i}catch(i){alert("圖片上傳失敗："+i.message)}finally{m.value=!1}}},A=async()=>{if(!o.value.name.trim())return alert("請輸入姓名");b.value=!0;try{await w.updateParticipant(a.myParticipant.id,o.value),v.value=!1,alert("更新成功！")}catch(d){alert("更新失敗："+d.message)}finally{b.value=!1}},P=async(d=!1)=>{var t;if(!f.value.trim())return alert("請輸入邀請碼");x.value=!0;try{const i=await Z(f.value.trim(),((t=a.user)==null?void 0:t.uid)||null,d);if(i.status===409)return confirm(i.message)?P(!0):void 0;i.status===200&&(a.setLocalParticipant(i.data.id),alert("認領成功！"),f.value="",await w.init())}catch(i){alert(i.message)}finally{x.value=!1}},D=async()=>{await a.logout(),k.push("/")};return(d,t)=>{var i,j,z,S,U,L,M;return l(),r("div",te,[e("header",se,[e("div",ae,[(i=s(a).myParticipant)!=null&&i.avatar?(l(),r("img",{key:0,src:s(a).myParticipant.avatar,class:"w-full h-full object-cover"},null,8,le)):(l(),g(s(T),{key:1,size:40}))]),e("h2",ie,y(((j=s(a).myParticipant)==null?void 0:j.name)||((z=s(a).user)==null?void 0:z.email)||"旅客"),1),e("p",oe,y(s(a).myParticipant?"已認領旅客身份":"個人設定與管理"),1),s(a).myParticipant?(l(),r("button",{key:0,onClick:E,class:"absolute top-6 right-6 w-10 h-10 bg-slate-50 text-slate-400 rounded-2xl flex items-center justify-center hover:bg-purple-50 hover:text-purple-500 transition-colors border border-slate-100"},[n(s(J),{size:18})])):c("",!0)]),s(a).myParticipant?c("",!0):(l(),r("section",re,[t[7]||(t[7]=e("h3",{class:"px-4 text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]"}," 認領旅客身份 ",-1)),e("div",ne,[t[6]||(t[6]=e("p",{class:"text-xs font-bold text-slate-500 leading-relaxed px-1"}," 請輸入 6 位邀請碼，以綁定你的旅遊手冊個人資料。 ",-1)),e("div",ce,[V(e("input",{"onUpdate:modelValue":t[0]||(t[0]=u=>f.value=u),type:"text",placeholder:"輸入 6 位邀請碼",class:"w-full bg-slate-50 border-none rounded-2xl p-4 pr-12 font-mono font-black text-slate-700 placeholder:text-slate-300 focus:ring-2 focus:ring-purple-500/20 transition-all outline-none",maxlength:"6"},null,512),[[B,f.value]]),e("div",de,[n(s(ee),{size:20})])]),e("button",{onClick:P,disabled:x.value||!f.value,class:"w-full bg-purple-500 text-white rounded-2xl py-4 font-black flex items-center justify-center gap-2 hover:bg-purple-600 disabled:opacity-50 transition-all shadow-lg shadow-purple-100"},[x.value?(l(),g(s(h),{key:0,class:"animate-spin",size:18})):c("",!0),I(" "+y(x.value?"驗證中...":"確認認領"),1)],8,ue)])])),e("section",pe,[t[10]||(t[10]=e("h3",{class:"px-4 text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]"}," 一般設定 ",-1)),e("div",fe,[(U=(S=s(a))==null?void 0:S.myParticipant)!=null&&U.isSuperAdmin||(M=(L=s(a))==null?void 0:L.myParticipant)!=null&&M.isAdmin?(l(),r("button",{key:0,onClick:t[1]||(t[1]=u=>s(k).push("/admin")),class:"w-full p-6 flex items-center gap-4 hover:bg-indigo-50 transition-colors group border-b border-slate-50"},[e("div",ve,[n(s(W),{size:20})]),t[8]||(t[8]=e("span",{class:"font-bold text-slate-700 flex-1 text-left"},"管理後台",-1)),n(s(N),{size:20,class:"text-slate-200"})])):c("",!0),s(a).myParticipant?(l(),r("button",{key:1,onClick:D,class:"w-full p-6 flex items-center gap-4 hover:bg-red-50 transition-colors group"},[e("div",xe,[n(s(Y),{size:20})]),t[9]||(t[9]=e("span",{class:"font-bold text-red-500 flex-1 text-left"},"登出帳號",-1)),n(s(N),{size:20,class:"text-red-200"})])):c("",!0)])]),t[14]||(t[14]=e("div",{class:"text-center pt-8"},[e("p",{class:"text-[10px] font-black text-slate-300 uppercase tracking-[0.3em]"}," 濟州小幫手 v1.0.0 ")],-1)),v.value?(l(),r("div",me,[e("div",{class:"absolute inset-0 bg-slate-900/40 backdrop-blur-sm",onClick:t[2]||(t[2]=u=>v.value=!1)}),e("div",be,[e("div",ye,[e("div",ge,[t[11]||(t[11]=e("h3",{class:"text-xl font-black text-slate-800"},"編輯個人資料",-1)),e("button",{onClick:t[3]||(t[3]=u=>v.value=!1),class:"w-8 h-8 bg-slate-50 rounded-xl flex items-center justify-center text-slate-400"},[n(s(X),{size:18})])]),e("div",he,[e("div",ke,[e("div",we,[o.value.avatar?(l(),r("img",{key:0,src:o.value.avatar,class:"w-full h-full object-cover"},null,8,_e)):(l(),r("div",Ce,[n(s(T),{size:32})])),m.value?(l(),r("div",Pe,[n(s(h),{class:"animate-spin text-purple-500",size:24})])):c("",!0),e("button",{onClick:C,class:"absolute inset-0 bg-slate-900/40 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"},[n(s(K),{size:20})])]),e("input",{type:"file",ref_key:"fileInput",ref:_,class:"hidden",accept:"image/*",onChange:F},null,544),e("div",je,[e("button",{onClick:C,class:"text-xs font-black text-purple-500 uppercase tracking-widest"},y(o.value.avatar?"更換頭像":"上傳頭像"),1),o.value.avatar?(l(),r("button",{key:0,onClick:t[4]||(t[4]=u=>o.value.avatar=""),class:"text-xs font-black text-red-400 uppercase tracking-widest"}," 移除 ")):c("",!0)])]),e("div",ze,[t[12]||(t[12]=e("label",{class:"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1"},"顯示名稱",-1)),V(e("input",{"onUpdate:modelValue":t[5]||(t[5]=u=>o.value.name=u),type:"text",placeholder:"旅客姓名",class:"w-full bg-slate-50 border-none rounded-2xl p-4 font-bold text-slate-700 placeholder:text-slate-300 focus:ring-2 focus:ring-purple-500/20 transition-all outline-none"},null,512),[[B,o.value.name]])]),e("button",{onClick:A,disabled:b.value||m.value,class:"w-full bg-slate-800 text-white rounded-2xl py-4 font-black flex items-center justify-center gap-2 hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg shadow-slate-200"},[b.value?(l(),g(s(h),{key:0,class:"animate-spin",size:18})):c("",!0),t[13]||(t[13]=I(" 確認儲存 ",-1))],8,Se)])])])])):c("",!0)])}}};typeof $=="function"&&$(Ue);export{Ue as default};
