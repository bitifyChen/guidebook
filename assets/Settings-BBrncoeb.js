import{k as D,x as O,l as R,o as l,c as r,a as e,b as s,q as y,t as g,d as n,f as c,w as V,e as B,g as I,C as $,X as H,i as u,$ as X,h as Z}from"./index-D6r3qpis.js";import{U as N,P as G,L as h,a as J,u as K}from"./storage-DnjityKE.js";import{b as T}from"./route-block-B_A1xBdJ.js";import{S as Q,L as W}from"./shield-check-B3NHzUFB.js";/**
 * @license lucide-vue-next v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=D("TicketIcon",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]),ee={class:"space-y-6 pb-20"},te={class:"bg-white p-8 rounded-[40px] border border-slate-100 flex flex-col items-center text-center relative group"},se={class:"w-20 h-20 bg-slate-50 rounded-3xl flex items-center justify-center text-slate-300 mb-4 border border-slate-100 overflow-hidden"},ae=["src"],le={class:"text-xl font-black text-slate-800"},ie={class:"text-xs font-bold text-slate-400 uppercase tracking-widest mt-1"},oe={key:0,class:"space-y-3"},re={class:"bg-white p-6 rounded-[32px] border border-slate-100 space-y-4"},ne={class:"relative"},ce={class:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-300"},de=["disabled"],ue={class:"space-y-3"},pe={class:"bg-white rounded-[40px] border border-slate-100 overflow-hidden"},fe={class:"w-10 h-10 bg-indigo-50 rounded-xl flex items-center justify-center text-indigo-500 group-hover:scale-110 transition-transform"},xe={class:"w-10 h-10 bg-red-50 rounded-xl flex items-center justify-center text-red-400 group-hover:scale-110 transition-transform"},ve={key:1,class:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4"},me={class:"relative w-full max-w-md bg-white rounded-[40px] shadow-2xl overflow-hidden animate-in slide-in-from-bottom duration-300"},be={class:"p-8"},ge={class:"flex justify-between items-center mb-8"},ye={class:"space-y-6"},he={class:"flex flex-col items-center"},ke={class:"w-24 h-24 rounded-3xl bg-slate-50 border-2 border-dashed border-slate-200 relative overflow-hidden group mb-2"},we=["src"],_e={key:1,class:"w-full h-full flex items-center justify-center text-slate-300"},Ce={key:2,class:"absolute inset-0 bg-white/80 flex items-center justify-center"},Pe={class:"flex gap-4"},je={class:"space-y-2"},ze=["disabled"],Se={__name:"Settings",setup(Ue){const k=Z(),a=O(),w=R(),p=u(""),x=u(!1),v=u(!1),m=u(!1),b=u(!1),o=u({name:"",avatar:""}),E=()=>{a.myParticipant&&(o.value={name:a.myParticipant.name,avatar:a.myParticipant.avatar||""},v.value=!0)},_=u(null),C=()=>_.value.click(),F=async f=>{const t=f.target.files[0];if(t){m.value=!0;try{const i=await K(t);o.value.avatar=i}catch(i){alert("圖片上傳失敗："+i.message)}finally{m.value=!1}}},q=async()=>{if(!o.value.name.trim())return alert("請輸入姓名");b.value=!0;try{await w.updateParticipant(a.myParticipant.id,o.value),v.value=!1,alert("更新成功！")}catch(f){alert("更新失敗："+f.message)}finally{b.value=!1}},P=async(f=!1)=>{var t;if(!p.value.trim())return alert("請輸入邀請碼");x.value=!0;try{const i=await X(p.value.trim(),((t=a.user)==null?void 0:t.uid)||null,f);if(i.status===409)return confirm(i.message)?P(!0):void 0;i.status===200&&(a.setLocalParticipant(i.data.id),alert("認領成功！"),p.value="",await w.init())}catch(i){alert(i.message)}finally{x.value=!1}},A=async()=>{await a.logout(),k.push("/")};return(f,t)=>{var i,j,z,S,U,L,M;return l(),r("div",ee,[e("header",te,[e("div",se,[(i=s(a).myParticipant)!=null&&i.avatar?(l(),r("img",{key:0,src:s(a).myParticipant.avatar,class:"w-full h-full object-cover"},null,8,ae)):(l(),y(s(N),{key:1,size:40}))]),e("h2",le,g(((j=s(a).myParticipant)==null?void 0:j.name)||((z=s(a).user)==null?void 0:z.email)||"旅客"),1),e("p",ie,g(s(a).myParticipant?"已認領旅客身份":"個人設定與管理"),1),s(a).myParticipant?(l(),r("button",{key:0,onClick:E,class:"absolute top-6 right-6 w-10 h-10 bg-slate-50 text-slate-400 rounded-2xl flex items-center justify-center hover:bg-purple-50 hover:text-purple-500 transition-colors border border-slate-100"},[n(s(G),{size:18})])):c("",!0)]),s(a).myParticipant?c("",!0):(l(),r("section",oe,[t[7]||(t[7]=e("h3",{class:"px-4 text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]"}," 認領旅客身份 ",-1)),e("div",re,[t[6]||(t[6]=e("p",{class:"text-xs font-bold text-slate-500 leading-relaxed px-1"}," 請輸入 6 位邀請碼，以綁定你的旅遊手冊個人資料。 ",-1)),e("div",ne,[V(e("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>p.value=d),type:"text",placeholder:"輸入 6 位邀請碼",class:"w-full bg-slate-50 border-none rounded-2xl p-4 pr-12 font-mono font-black text-slate-700 placeholder:text-slate-300 focus:ring-2 focus:ring-purple-500/20 transition-all outline-none",maxlength:"6"},null,512),[[B,p.value]]),e("div",ce,[n(s(Y),{size:20})])]),e("button",{onClick:P,disabled:x.value||!p.value,class:"w-full bg-purple-500 text-white rounded-2xl py-4 font-black flex items-center justify-center gap-2 hover:bg-purple-600 disabled:opacity-50 transition-all shadow-lg shadow-purple-100"},[x.value?(l(),y(s(h),{key:0,class:"animate-spin",size:18})):c("",!0),I(" "+g(x.value?"驗證中...":"確認認領"),1)],8,de)])])),e("section",ue,[t[10]||(t[10]=e("h3",{class:"px-4 text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]"}," 一般設定 ",-1)),e("div",pe,[(U=(S=s(a))==null?void 0:S.myParticipant)!=null&&U.isSuperAdmin||(M=(L=s(a))==null?void 0:L.myParticipant)!=null&&M.isAdmin?(l(),r("button",{key:0,onClick:t[1]||(t[1]=d=>s(k).push("/admin")),class:"w-full p-6 flex items-center gap-4 hover:bg-indigo-50 transition-colors group border-b border-slate-50"},[e("div",fe,[n(s(Q),{size:20})]),t[8]||(t[8]=e("span",{class:"font-bold text-slate-700 flex-1 text-left"},"管理後台",-1)),n(s($),{size:20,class:"text-slate-200"})])):c("",!0),s(a).myParticipant?(l(),r("button",{key:1,onClick:A,class:"w-full p-6 flex items-center gap-4 hover:bg-red-50 transition-colors group"},[e("div",xe,[n(s(W),{size:20})]),t[9]||(t[9]=e("span",{class:"font-bold text-red-500 flex-1 text-left"},"登出帳號",-1)),n(s($),{size:20,class:"text-red-200"})])):c("",!0)])]),t[14]||(t[14]=e("div",{class:"text-center pt-8"},[e("p",{class:"text-[10px] font-black text-slate-300 uppercase tracking-[0.3em]"}," 濟州小幫手 v1.0.0 ")],-1)),v.value?(l(),r("div",ve,[e("div",{class:"absolute inset-0 bg-slate-900/40 backdrop-blur-sm",onClick:t[2]||(t[2]=d=>v.value=!1)}),e("div",me,[e("div",be,[e("div",ge,[t[11]||(t[11]=e("h3",{class:"text-xl font-black text-slate-800"},"編輯個人資料",-1)),e("button",{onClick:t[3]||(t[3]=d=>v.value=!1),class:"w-8 h-8 bg-slate-50 rounded-xl flex items-center justify-center text-slate-400"},[n(s(H),{size:18})])]),e("div",ye,[e("div",he,[e("div",ke,[o.value.avatar?(l(),r("img",{key:0,src:o.value.avatar,class:"w-full h-full object-cover"},null,8,we)):(l(),r("div",_e,[n(s(N),{size:32})])),m.value?(l(),r("div",Ce,[n(s(h),{class:"animate-spin text-purple-500",size:24})])):c("",!0),e("button",{onClick:C,class:"absolute inset-0 bg-slate-900/40 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"},[n(s(J),{size:20})])]),e("input",{type:"file",ref_key:"fileInput",ref:_,class:"hidden",accept:"image/*",onChange:F},null,544),e("div",Pe,[e("button",{onClick:C,class:"text-xs font-black text-purple-500 uppercase tracking-widest"},g(o.value.avatar?"更換頭像":"上傳頭像"),1),o.value.avatar?(l(),r("button",{key:0,onClick:t[4]||(t[4]=d=>o.value.avatar=""),class:"text-xs font-black text-red-400 uppercase tracking-widest"}," 移除 ")):c("",!0)])]),e("div",je,[t[12]||(t[12]=e("label",{class:"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1"},"顯示名稱",-1)),V(e("input",{"onUpdate:modelValue":t[5]||(t[5]=d=>o.value.name=d),type:"text",placeholder:"旅客姓名",class:"w-full bg-slate-50 border-none rounded-2xl p-4 font-bold text-slate-700 placeholder:text-slate-300 focus:ring-2 focus:ring-purple-500/20 transition-all outline-none"},null,512),[[B,o.value.name]])]),e("button",{onClick:q,disabled:b.value||m.value,class:"w-full bg-slate-800 text-white rounded-2xl py-4 font-black flex items-center justify-center gap-2 hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg shadow-slate-200"},[b.value?(l(),y(s(h),{key:0,class:"animate-spin",size:18})):c("",!0),t[13]||(t[13]=I(" 確認儲存 ",-1))],8,ze)])])])])):c("",!0)])}}};typeof T=="function"&&T(Se);export{Se as default};
