import{k as j,l as L,m as N,n as D,c as o,a as e,b as i,d as r,q as c,R as B,F,r as E,f,t as v,X as R,w as q,e as O,s as A,g as W,h as X,i as u,o as n,x as G}from"./index-q_XVsHof.js";import{L as y,U as k,a as H,u as J,P as K}from"./storage-CcIkiKfF.js";import{b as S}from"./route-block-B_A1xBdJ.js";import{C as Q}from"./chevron-left-BNWO3xbk.js";import{P as Y}from"./plus-j-Br_-z6.js";import{T as Z}from"./trash-2-ot3ZQDNM.js";/**
 * @license lucide-vue-next v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=j("CheckIcon",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-vue-next v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=j("CopyIcon",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),se={class:"min-h-screen bg-slate-50 pb-20"},ae={class:"p-6 sticky top-0 bg-slate-50/80 backdrop-blur-md z-40 flex items-center justify-between"},le={class:"flex gap-2"},ie=["disabled"],ne={class:"max-w-4xl mx-auto p-6"},oe={key:0,class:"flex justify-center py-12"},re={key:1,class:"grid gap-4"},de={class:"w-16 h-16 rounded-2xl bg-slate-100 overflow-hidden border border-slate-50 flex-shrink-0"},ce=["src"],ue={key:1,class:"w-full h-full flex items-center justify-center text-slate-300"},pe={class:"flex-1"},fe={class:"flex items-center gap-2"},me={class:"font-black text-slate-800 text-lg"},ve={key:0,class:"bg-indigo-500 text-[8px] font-black text-white px-1.5 py-0.5 rounded-md uppercase tracking-tighter"},xe={key:1,class:"bg-blue-500 text-[8px] font-black text-white px-1.5 py-0.5 rounded-md uppercase tracking-tighter"},be=["onClick"],he={class:"text-[10px] font-mono font-black text-slate-600"},ge={class:"flex gap-2"},ye=["onClick"],ke=["onClick"],_e={key:0,class:"text-center py-20 bg-white rounded-[40px] border border-dashed border-slate-200"},we={class:"w-16 h-16 bg-slate-50 rounded-3xl flex items-center justify-center mx-auto text-slate-200 mb-4"},Ce={key:0,class:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4"},Ae={class:"relative w-full max-w-md bg-white rounded-[40px] shadow-2xl overflow-hidden animate-in slide-in-from-bottom duration-300"},Se={class:"p-8"},je={class:"flex justify-between items-center mb-8"},ze={class:"text-xl font-black text-slate-800"},Ie={class:"space-y-6"},Pe={class:"flex flex-col items-center"},$e={class:"w-24 h-24 rounded-3xl bg-slate-50 border-2 border-dashed border-slate-200 relative overflow-hidden group mb-2"},Me=["src"],Te={key:1,class:"w-full h-full flex items-center justify-center text-slate-300"},Ue={key:2,class:"absolute inset-0 bg-white/80 flex items-center justify-center"},Ve={class:"flex gap-4"},Le={class:"space-y-2"},Ne={class:"grid grid-cols-2 gap-4"},De=["disabled"],Be={__name:"participants",setup(Fe){const z=X(),d=L(),m=u(!1),x=u(!1),b=u(!1);N(m,t=>{t?document.body.style.overflow="hidden":document.body.style.overflow=""});const h=u(null),p=u(null),s=u({name:"",avatar:"",isAdmin:!1,isSuperAdmin:!1});D(()=>{d.init()});const I=(t,a)=>{navigator.clipboard.writeText(t),h.value=a,setTimeout(()=>{h.value=null},2e3)},P=async()=>{if(confirm("將檢查所有記帳資料並移除無效的旅客 ID，確定要執行嗎？")){isSyncing.value=!0;try{const t=await d.syncWalletParticipants();alert(`同步完成！
刪除無效支出：${t.deleteCount} 筆
更新分帳名單：${t.updateCount} 筆`)}catch(t){alert("同步失敗："+t.message)}finally{isSyncing.value=!1}}},$=()=>{p.value=null,s.value={name:"",avatar:"",isAdmin:!1,isSuperAdmin:!1},m.value=!0},M=t=>{p.value=t.id,s.value={name:t.name,avatar:t.avatar,isAdmin:t.isAdmin||!1,isSuperAdmin:t.isSuperAdmin||!1},m.value=!0},g=()=>{m.value=!1},_=u(null),w=()=>{_.value.click()},T=async t=>{const a=t.target.files[0];if(a){x.value=!0;try{const l=await J(a);s.value.avatar=l}catch(l){alert("圖片上傳失敗："+l.message)}finally{x.value=!1,t.target.value=""}}},U=async()=>{if(!s.value.name.trim())return alert("請輸入姓名");b.value=!0;try{const t={name:s.value.name,avatar:s.value.avatar||"",isAdmin:s.value.isAdmin,isSuperAdmin:s.value.isSuperAdmin};p.value?await d.updateParticipant(p.value,t):await d.addParticipant(t),g()}catch(t){alert("儲存失敗："+t.message)}finally{b.value=!1}},V=async t=>{if(confirm("確定要刪除這位旅客嗎？"))try{await d.removeParticipant(t)}catch(a){alert("刪除失敗："+a.message)}};return(t,a)=>(n(),o("div",se,[e("nav",ae,[e("button",{onClick:a[0]||(a[0]=l=>i(z).push("/admin")),class:"w-10 h-10 bg-white rounded-2xl flex items-center justify-center shadow-sm border border-slate-100"},[r(i(Q),{size:20})]),a[5]||(a[5]=e("h2",{class:"font-black text-slate-800 text-lg"},"旅客名單管理",-1)),e("div",le,[e("button",{onClick:P,disabled:t.isSyncing,class:"w-10 h-10 bg-white text-slate-400 rounded-2xl flex items-center justify-center shadow-sm border border-slate-100 hover:text-blue-500 disabled:opacity-50",title:"同步記帳資料"},[r(i(B),{size:20,class:c({"animate-spin":t.isSyncing})},null,8,["class"])],8,ie),e("button",{onClick:$,class:"w-10 h-10 bg-purple-500 text-white rounded-2xl flex items-center justify-center shadow-sm"},[r(i(Y),{size:20})])])]),e("main",ne,[i(d).isLoading?(n(),o("div",oe,[r(i(y),{class:"animate-spin text-slate-300",size:32})])):(n(),o("div",re,[(n(!0),o(F,null,E(i(d).participants,l=>(n(),o("div",{key:l.id,class:"bg-white p-4 rounded-3xl border border-slate-100 flex items-center gap-4"},[e("div",de,[l.avatar?(n(),o("img",{key:0,src:l.avatar,class:"w-full h-full object-cover"},null,8,ce)):(n(),o("div",ue,[r(i(k),{size:24})]))]),e("div",pe,[e("div",fe,[e("div",me,v(l.name),1),l.isSuperAdmin?(n(),o("div",ve,"Super Admin")):l.isAdmin?(n(),o("div",xe,"Admin")):f("",!0)]),e("div",{onClick:C=>I(l.inviteCode,l.id),class:"inline-flex items-center gap-1.5 bg-slate-50 px-2 py-0.5 rounded-lg border border-slate-100 cursor-pointer hover:bg-slate-100 transition-colors mt-1"},[a[6]||(a[6]=e("span",{class:"text-[10px] font-mono font-bold text-slate-400"},"INVITE:",-1)),e("span",he,v(l.inviteCode||"N/A"),1),(n(),A(G(h.value===l.id?i(ee):i(te)),{size:10,class:c(h.value===l.id?"text-green-500":"text-slate-300")},null,8,["class"]))],8,be)]),e("div",ge,[e("button",{onClick:C=>M(l),class:"w-10 h-10 bg-slate-50 text-slate-400 rounded-xl flex items-center justify-center hover:bg-purple-50 hover:text-purple-500 transition-colors"},[r(i(K),{size:18})],8,ye),e("button",{onClick:C=>V(l.id),class:"w-10 h-10 bg-slate-50 text-slate-400 rounded-xl flex items-center justify-center hover:bg-red-50 hover:text-red-500 transition-colors"},[r(i(Z),{size:18})],8,ke)])]))),128)),i(d).participants.length===0?(n(),o("div",_e,[e("div",we,[r(i(k),{size:32})]),a[7]||(a[7]=e("p",{class:"text-sm font-bold text-slate-400"},"目前還沒有旅客名單",-1))])):f("",!0)]))]),m.value?(n(),o("div",Ce,[e("div",{class:"absolute inset-0 bg-slate-900/40 backdrop-blur-sm",onClick:g}),e("div",Ae,[e("div",Se,[e("div",je,[e("h3",ze,v(p.value?"編輯旅客":"新增旅客"),1),e("button",{onClick:g,class:"w-8 h-8 bg-slate-50 rounded-xl flex items-center justify-center text-slate-400"},[r(i(R),{size:18})])]),e("div",Ie,[e("div",Pe,[e("div",$e,[s.value.avatar?(n(),o("img",{key:0,src:s.value.avatar,class:"w-full h-full object-cover"},null,8,Me)):(n(),o("div",Te,[r(i(k),{size:32})])),x.value?(n(),o("div",Ue,[r(i(y),{class:"animate-spin text-purple-500",size:24})])):f("",!0),e("button",{onClick:w,class:"absolute inset-0 bg-slate-900/40 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"},[r(i(H),{size:20})])]),e("input",{type:"file",ref_key:"fileInput",ref:_,class:"hidden",accept:"image/*",onChange:T},null,544),e("div",Ve,[e("button",{onClick:w,class:"text-xs font-black text-purple-500 uppercase tracking-widest"},v(s.value.avatar?"更換頭像":"上傳頭像"),1),s.value.avatar?(n(),o("button",{key:0,onClick:a[1]||(a[1]=l=>s.value.avatar=""),class:"text-xs font-black text-red-400 uppercase tracking-widest"}," 移除 ")):f("",!0)])]),e("div",Le,[a[8]||(a[8]=e("label",{class:"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1"},"旅客姓名",-1)),q(e("input",{"onUpdate:modelValue":a[2]||(a[2]=l=>s.value.name=l),type:"text",placeholder:"例如：小明",class:"w-full bg-slate-50 border-none rounded-2xl p-4 font-bold text-slate-700 placeholder:text-slate-300 focus:ring-2 focus:ring-purple-500/20 transition-all outline-none"},null,512),[[O,s.value.name]])]),e("div",Ne,[e("div",{onClick:a[3]||(a[3]=l=>s.value.isAdmin=!s.value.isAdmin),class:c(["p-4 rounded-2xl border-2 transition-all cursor-pointer flex flex-col gap-1",s.value.isAdmin?"border-blue-500 bg-blue-50":"border-slate-50 bg-slate-50"])},[e("span",{class:c(["text-[10px] font-black uppercase tracking-widest",s.value.isAdmin?"text-blue-500":"text-slate-400"])},"Admin",2),e("span",{class:c(["text-[8px] font-bold",s.value.isAdmin?"text-blue-400":"text-slate-300"])},"擁有管理權限",2)],2),e("div",{onClick:a[4]||(a[4]=l=>s.value.isSuperAdmin=!s.value.isSuperAdmin),class:c(["p-4 rounded-2xl border-2 transition-all cursor-pointer flex flex-col gap-1",s.value.isSuperAdmin?"border-indigo-500 bg-indigo-50":"border-slate-50 bg-slate-50"])},[e("span",{class:c(["text-[10px] font-black uppercase tracking-widest",s.value.isSuperAdmin?"text-indigo-500":"text-slate-400"])},"Super Admin",2),e("span",{class:c(["text-[8px] font-bold",s.value.isSuperAdmin?"text-indigo-400":"text-slate-300"])},"擁有系統權限",2)],2)]),e("button",{onClick:U,disabled:b.value||x.value,class:"w-full bg-slate-800 text-white rounded-2xl py-4 font-black flex items-center justify-center gap-2 hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg shadow-slate-200"},[b.value?(n(),A(i(y),{key:0,class:"animate-spin",size:18})):f("",!0),W(" "+v(p.value?"儲存變更":"確認新增"),1)],8,De)])])])])):f("",!0)]))}};typeof S=="function"&&S(Be);export{Be as default};
